<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每日靈糧最新影片</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <h1>每日靈糧最新影片</h1>
    <button id="copyButton">複製所有影片連結</button>
    <ul id="videoList"></ul>
    <script>
        const apiKey = 'AIzaSyAmlThKq4RMPAbU7lZKwe34vWnyNkn_GrY';
        const channelIds = [
            'UCfEbx5pXwoQuj-Y2M6zsDfw',
            'UCRuspsZ4t6X-ot5B6n151qg',
            'UCNBgquLyP2zOAJURDJAUYTA',
            'UCV_iUJtaJA62vnM9hM_opRw'
        ];

        function fetchUploadsPlaylistId(channelId) {
            return $.ajax({
                url: `https://www.googleapis.com/youtube/v3/channels?key=${apiKey}&id=${channelId}&part=contentDetails`,
                dataType: 'json'
            });
        }

        function fetchLatestVideo(uploadsPlaylistId) {
            return $.ajax({
                url: `https://www.googleapis.com/youtube/v3/playlistItems?key=${apiKey}&playlistId=${uploadsPlaylistId}&part=snippet&maxResults=1`,
                dataType: 'json'
            });
        }

        function displayVideoList(videos) {
            const $videoList = $('#videoList');
            $videoList.empty();

            videos.forEach((video, index) => {
                const videoUrl = `https://youtu.be/${video.snippet.resourceId.videoId}`;
                const videoTitleArray = [
                    '活潑的生命',
                    '心靈蜜豆奶',
                    '恩典365',
                    '陪你讀聖經'
                ];

                const videoTitle = videoTitleArray[index];
                const videoSubtitle = video.snippet.title;
                $videoList.append(`<li>${videoTitle}：<br>${videoSubtitle}<br><a href="${videoUrl}" target="_blank">${videoUrl}</a></li>`);
            });
        }

        async function fetchAndDisplayLatestVideos() {
            const playlistRequests = await Promise.all(channelIds.map(fetchUploadsPlaylistId));
            const uploadsPlaylistIds = playlistRequests.map(response => response.items[0].contentDetails.relatedPlaylists.uploads);
            const videoRequests = await Promise.all(uploadsPlaylistIds.map(fetchLatestVideo));
            const videos = videoRequests.map(response => response.items[0]);
            displayVideoList(videos);
        }

        $(document).ready(fetchAndDisplayLatestVideos);

        // 新增的複製按鈕功能
        $('#copyButton').click(function() {
            const listItems = $('#videoList li');
            let textToCopy = '';
            listItems.each(function() {
                textToCopy += $(this).html().replace(/<br>/g, '\n') + '\n';
            });    
            const $tempInput = $('<textarea>');
            $('body').append($tempInput);
            $tempInput.val(textToCopy).select();
            document.execCommand('copy');
            $tempInput.remove();
            alert('已複製所有影片連結');
        }
    );
</script>

    </script>
</body>

</html>
