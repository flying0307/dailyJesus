<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每日靈糧最新影片</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        .yt-icon {
            font-family: 'Material Symbols Outlined';
            font-size: 30px;
            cursor: pointer;
        }

        .link-container {
            display: inline-flex;
            align-items: center;
        }
    </style>
    
</head>

<body>
    <h1>每日靈糧最新影片</h1>
    <button id="copyButton">複製所有影片連結</button>
    <ul id="videoList"></ul>
    <div id="copyList" hidden='true'></hide>
    <script>
        const apiKey = 'AIzaSyAmlThKq4RMPAbU7lZKwe34vWnyNkn_GrY';
        const channelIds = [
            'UCfEbx5pXwoQuj-Y2M6zsDfw',
            'UCRuspsZ4t6X-ot5B6n151qg',
            'UCNBgquLyP2zOAJURDJAUYTA',
            'UCV_iUJtaJA62vnM9hM_opRw'
        ];

        function fetchUploadsPlaylistId(channelId) {
            return $.ajax({
                url: `https://www.googleapis.com/youtube/v3/channels?key=${apiKey}&id=${channelId}&part=contentDetails`,
                dataType: 'json'
            });
        }

        function fetchLatestVideo(uploadsPlaylistId) {
            return $.ajax({
                url: `https://www.googleapis.com/youtube/v3/playlistItems?key=${apiKey}&playlistId=${uploadsPlaylistId}&part=snippet&maxResults=1`,
                dataType: 'json'
            });
        }

        function displayVideoList(videos) {
            const $videoList = $('#videoList');
            $videoList.empty();
            const $copyList = $('#copyList');
            $copyList.empty();
            videos.forEach((video, index) => {
                const videoId = `${video.snippet.resourceId.videoId}`;
                const videoUrl = `https://youtu.be/${video.snippet.resourceId.videoId}`;
                const openYtApp = `vnd.youtube://${video.snippet.resourceId.videoId}`;
                var finalYt = ``;
                // 檢查是否為移動設備
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

                const videoTitleArray = [
                    '活潑的生命',
                    '心靈蜜豆奶',
                    '恩典365',
                    '陪你讀聖經'
                ];
                
                const videoTitle = videoTitleArray[index];
                const videoSubtitle = video.snippet.title;
                $videoList.append(`<li>${videoTitle}：<br>${videoSubtitle}<br><div class="link-container"><a href="${videoUrl}?autoplay=1" target="_blank">${videoUrl}</a><span class="yt-icon" data-video-id="${videoId}" hidden=${isMobile}>open_in_new</span></div></li>`);
                $copyList.append(`${videoTitle}：\n${videoUrl}`);
                if(index < 3)
                    $copyList.append(`\n`);
            });
        }

        async function fetchAndDisplayLatestVideos() {
            const playlistRequests = await Promise.all(channelIds.map(fetchUploadsPlaylistId));
            const uploadsPlaylistIds = playlistRequests.map(response => response.items[0].contentDetails.relatedPlaylists.uploads);
            const videoRequests = await Promise.all(uploadsPlaylistIds.map(fetchLatestVideo));
            const videos = videoRequests.map(response => response.items[0]);
            displayVideoList(videos);
            
            $('.yt-icon').on('click', function () {
                const videoId = $(this).data('video-id');
                const appUrl = `vnd.youtube://${videoId}`;
                window.location.href = appUrl;
            });
        }

        $(document).ready(fetchAndDisplayLatestVideos);

        // 新增的複製按鈕功能
        $('#copyButton').click(function() {
            let textToCopy = $('#copyList').text();
            
            const $tempInput = $('<textarea>');
            $('body').append($tempInput);
            $tempInput.val(textToCopy).select();
            document.execCommand('copy');
            $tempInput.remove();
            alert('已複製所有影片連結');
        });

</script>

    </script>
</body>

</html>
